<div id="article_content" class="article_content clearfix">
        <link rel="stylesheet" href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/ck_htmledit_views-b5506197d8.css">
                <div id="content_views" class="htmledit_views">
                    <p><strong>文件I/O常用头文件</strong></p> 
<pre class="has" name="code"><code class="hljs cpp"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/types.h&gt;    //定义数据类型，如ssize_t等</span></span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;fcntl.h&gt;        //定义open,create等函数原型，创建文件权限的符号常量S_IRUSR等</span></span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;       //定义read,write,close,lseek等函数原型</span></span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;errno.h&gt;        //与全局变量errno相关的定义</span></span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/ioctl.h&gt;    //定义ioctl函数原型</span></span></div></div></li></ol></code><div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}" onclick="hljs.copyCode(event)"></div></pre> 
<p id="main-toc"><strong>目录</strong></p> 
<p id="" style="margin-left:80px;"><a href="#t0" target="_self">一、open函数</a></p> 
<p id="" style="margin-left:80px;"><a href="#t1" target="_self">二、creat函数</a></p> 
<p id="" style="margin-left:80px;"><a href="#t2" target="_self">三、close函数</a></p> 
<p id="" style="margin-left:80px;"><a href="#t3" target="_self">四、read函数</a></p> 
<p id="" style="margin-left:80px;"><a href="#t4" target="_self">五、write函数</a></p> 
<p id="" style="margin-left:80px;"><a href="#t5" target="_self">六、fsync函数</a></p> 
<p id="" style="margin-left:80px;"><a href="#t6" target="_self">七、lseek函数</a></p> 
<p id="" style="margin-left:80px;"><a href="#t7" target="_self">八、ioctl函数</a></p> 
<hr id="hr-toc">
<h3 id="%E4%B8%80%E3%80%81open%E5%87%BD%E6%95%B0"><a name="t0"></a><a name="t0"></a>一、open函数</h3> 
<p style="text-indent:0;"><strong>1.进行文件I/O操作时，要先调用open()函数打开文件，它返回的文件描述符fd就代表了所打开的文件，后续的其他操作均通过引用该文件描述符fd进行。open()函数原型在&lt;fcntl.h&gt;中定义：</strong></p> 
<pre class="has" name="code"><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">open</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *pathname, <span class="hljs-keyword">int</span> flags, ...<span class="hljs-comment">/*mode_t mode*/</span>)</span></span>;</code><div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}" onclick="hljs.copyCode(event)"></div></pre> 
<p style="text-indent:0;"><strong>2.1 open()参数</strong></p> 
<div class="table-box"><table border="1" cellpadding="1" cellspacing="1"><thead><tr><th style="text-align:center;width:116px;">参数</th><th style="text-align:center;width:137px;"> <p>打开文件标志</p> </th><th style="text-align:center;width:596px;">含义</th></tr></thead><tbody><tr><td style="width:116px;"><strong><em>pathname</em></strong></td><td style="width:137px;">-</td><td style="width:596px;">C字符串形式的文件名</td></tr><tr><td colspan="1" rowspan="12" style="width:116px;"><strong><em>flags</em></strong></td><td style="width:137px;">O_RDONLY</td><td style="width:596px;">以只读方式打开文件，与O_WRONLY和O_RDWR互斥</td></tr><tr><td style="width:137px;">O_WRONLY</td><td style="width:596px;">以只写方式打开文件，与O_RDONLY和O_RDWR互斥</td></tr><tr><td style="width:137px;">O_RDWR</td><td style="width:596px;">以可读写方式打开文件，与O_WRONLY和O_RDONLY互斥</td></tr><tr><td style="width:137px;">O_CREAT</td><td style="width:596px;">如果要打开的文件不存在，则创建该文件</td></tr><tr><td style="width:137px;">O_EXCL</td><td style="width:596px;">该标志与 O_CREAT 共同使用时，会去检查文件是否存在，若文件不存在则创建该文件，否则将导致打开文件失败。此外，打开文件链接时，使用该标志将导致失败</td></tr><tr><td style="width:137px;">O_NOCTTY</td><td style="width:596px;">如果要打开的文件为终端设备时，则不把终端设备当成进行控制终端</td></tr><tr><td style="width:137px;">O_TRUNC</td><td style="width:596px;">若文件存在且以可写方式打开，此标志会清除文件内容，并将其长度置为0</td></tr><tr><td style="width:137px;">O_APPEND</td><td style="width:596px;">读写文件都从文件的尾部开始，所写入的数据会以附加的方式加入到文件末尾</td></tr><tr><td style="width:137px;">O_NONBLOCK</td><td style="width:596px;">以不可阻塞方式打开文件，也就是不管有无数据需要读写或者等待，都会立刻返回</td></tr><tr><td style="width:137px;">O_SYNC</td><td style="width:596px;">以同步方式打开文件</td></tr><tr><td style="width:137px;">O_NOFOLLOW</td><td style="width:596px;">如果文件名所指向的文件本身为符号链接，则会导致打开文件失败</td></tr><tr><td style="width:137px;">O_DIRECTORY</td><td style="width:596px;">如果文件名所指向的文件本身并非目录，则会导致打开文件失败</td></tr><tr><td colspan="1" style="width:116px;"><strong><em>mode</em></strong></td><td style="width:137px;">-</td><td style="width:596px;">创建文件的权限模式，可以用八进制数来表示新文件的权限，也可采用&lt;fcntl.h&gt;中定义的符号常量。当打开已有文件时，将忽略这个参数</td></tr></tbody></table></div>
<p style="text-indent:0;"><strong>2.2&nbsp;mode参数可用的符号常量表</strong></p> 
<div class="table-box"><table border="1" cellpadding="1" cellspacing="1"><thead><tr><th style="text-align:center;"><strong>符号常量</strong></th><th style="text-align:center;"><strong>值</strong></th><th style="text-align:center;"><strong>含义</strong></th><th style="text-align:center;"><strong>符号常量</strong></th><th style="text-align:center;"><strong>值</strong></th><th style="text-align:center;"><strong>含义</strong></th></tr></thead><tbody><tr><td>S_IRWXU</td><td>0x700</td><td>所属用户读、写和执行权限</td><td>S_IRWXG</td><td>0x070</td><td>组用户读、写和执行权限</td></tr><tr><td>S_IRUSR</td><td>0x400</td><td>所属用户读权限</td><td>S_IRGRP</td><td>0x040</td><td> <p>组用户读权限</p> </td></tr><tr><td>S_IWUSR</td><td>0x200</td><td>所属用户写权限</td><td>S_IWGRP</td><td>0x020</td><td>组用户写权限</td></tr><tr><td>S_IXUSR</td><td>0x100</td><td>所属用户执行权限</td><td>S_IXGRP</td><td>0x010</td><td>组用户执行权限</td></tr><tr><td>S_IRWXO</td><td>0x007</td><td>其他用户读、写和执行权限</td><td>S_IWOTH</td><td>0x002</td><td>其他用户写权限</td></tr><tr><td>S_IROTH</td><td>0x004</td><td>其他用户读权限</td><td>S_IXOTH</td><td>0x001</td><td>其他用户执行权限</td></tr></tbody></table></div>
<h3 id="%E4%BA%8C%E3%80%81create%E5%87%BD%E6%95%B0"><a name="t1"></a><a name="t1"></a>二、creat函数</h3> 
<p style="text-indent:0;"><strong>1.open()函数的参数flags，当设置了O_CREAT标志时，可以创建一个新文件，也可以用另外一个函数creat()创建新文件，creat()函数原型在&lt;fcntl.h&gt;文件中定义：</strong></p> 
<pre class="has" name="code"><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">creat</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *pathname, <span class="hljs-keyword">mode_t</span> mode)</span></span>;    <span class="hljs-comment">//参数pathname,mode同open</span></code><div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}" onclick="hljs.copyCode(event)"></div></pre> 
<p style="text-indent:0;"><strong>2.open与creat区别注意：</strong></p> 
<p style="text-indent:50px;"><strong>（1）creat()创建文件时，<span style="color:#f33b45;"><em>如果文件已存在，则会把已存在的文件内容清空、长度截为0</em></span>，然后返回对应的文件描述符；如果文件不存在，则直接创建，然后返回文件描述符</strong></p> 
<p style="text-indent:50px;"><strong>&nbsp; &nbsp;(2) &nbsp; 当open()的参数flags设置了O_CREAT时，如果文件已存在，则直接打开并返回文件描述符；<span style="color:#f33b45;"><em>如果文件不存在，则创建新文件</em></span>，然后返回对应的文件描述符</strong></p> 
<p style="text-indent:0;">&nbsp;</p> 
<h3 id="%E4%B8%89%E3%80%81close%E5%87%BD%E6%95%B0"><a name="t2"></a><a name="t2"></a><strong>三、close函数</strong></h3> 
<p style="text-indent:0;"><strong>1.文件I/O操作完成后，应该调用close()关闭打开的文件，释放打开文件时所占用的系统资源，close()函数原型在&lt;unistd.h&gt;中定义：</strong></p> 
<pre class="has" name="code"><code class="hljs go"><span class="hljs-keyword">int</span> <span class="hljs-built_in">close</span>(<span class="hljs-keyword">int</span> fd);    <span class="hljs-comment">//fd为open()或creat()返回的文件描述符</span></code><div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}" onclick="hljs.copyCode(event)"></div></pre> 
<h3 id="%E5%9B%9B%E3%80%81read%E5%87%BD%E6%95%B0"><a name="t3"></a><a name="t3"></a>四、read函数</h3> 
<p style="text-indent:0;"><strong>1.从打开的文件读取数据，可调用read()函数实现，read()函数原型在&lt;unistd.h&gt;中定义：</strong></p> 
<pre class="has" name="code"><code class="language-Swift hljs">ssize_t read(int fd, void *buf, size_t <span class="hljs-built_in">count</span>);</code><div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}" onclick="hljs.copyCode(event)"></div></pre> 
<p style="text-indent:50px;"><strong>操作成功，返回实际读取的字符数，如果已达到文件结尾，返回0,，否则返回-1</strong></p> 
<p style="text-indent:0;"><strong>2.参数：</strong></p> 
<p style="text-indent:50px;"><strong>（1）fd：open()或creat()返回的文件描述符</strong></p> 
<p style="text-indent:50px;"><strong>（2）buf：用来接收所读数据的缓冲区</strong></p> 
<p style="text-indent:50px;"><strong>（3）count：请求读取的字节数，其中若文件长度小于请求的长度，则首次调用read时，返回文件长度，下次调用时返回0。读设备文件时，有些设备每读到一行数据，就返回</strong></p> 
<p style="text-indent:50px;">&nbsp;</p> 
<h3 id="%E4%BA%94%E3%80%81write%E5%87%BD%E6%95%B0"><a name="t4"></a><a name="t4"></a>五、write函数</h3> 
<p style="text-indent:0;"><strong>1.把数据写入文件，可调用write()函数实现，write()函数原型在&lt;unistd.h&gt;中定义：</strong></p> 
<pre class="has" name="code"><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">ssize_t</span> <span class="hljs-title">write</span><span class="hljs-params">(<span class="hljs-keyword">int</span> fd, <span class="hljs-keyword">void</span> *buf, <span class="hljs-keyword">size_t</span> count)</span></span>;</code><div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}" onclick="hljs.copyCode(event)"></div></pre> 
<p style="text-indent:50px;"><strong>操作成功，返回实际写入的字节数，出错则返回-1</strong></p> 
<p style="text-indent:0;"><strong>2.参数：同read()</strong></p> 
<p style="text-indent:50px;">&nbsp;</p> 
<h3 id="%E5%85%AD%E3%80%81fsync%E5%87%BD%E6%95%B0"><a name="t5"></a><a name="t5"></a><strong>六、fsync函数</strong></h3> 
<p style="text-indent:0;"><strong>1.write()函数一旦返回，表明所写的数据已提交到系统内部缓存，但此时数据不一定写入了磁盘等持久存储设备中。要确保已修改过的数据全部写入持久设备中，正确的做法是调用fsync函数进行文件数据同步，强制把已修改的文件数据写入持久存储设备中。其原型在&lt;unistd.h&gt;中定义：</strong></p> 
<pre class="has" name="code"><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">fsync</span><span class="hljs-params">(<span class="hljs-keyword">int</span> fd)</span></span>;</code><div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}" onclick="hljs.copyCode(event)"></div></pre> 
<p style="text-indent:50px;"><strong>操作成功返回0，否则返回-1</strong></p> 
<h3 id="%E4%B8%83%E3%80%81lseek%E5%87%BD%E6%95%B0"><a name="t6"></a><a name="t6"></a>七、lseek函数</h3> 
<p style="text-indent:0;"><strong>1.Linux文件按读写方式可分为顺序读写和随机读写文件。普通磁盘文件一般都能随机读写，这类文件可通过lseek()函数改变文件读写位置。lseek()函数不会读写任何文件数据，仅仅是改变文件的起始读写位置。lseek()函数原型在&lt;unistd.h&gt;中定义：</strong></p> 
<pre class="has" name="code"><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">off_t</span> <span class="hljs-title">lseek</span><span class="hljs-params">(<span class="hljs-keyword">int</span> fd, <span class="hljs-keyword">off_t</span> offset, <span class="hljs-keyword">int</span> whence)</span></span>;</code><div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}" onclick="hljs.copyCode(event)"></div></pre> 
<p style="text-indent:50px;"><strong>如果操作成功，lseek()返回新的读写位置；否则返回-1</strong></p> 
<p style="text-indent:0;"><strong>2.参数：</strong></p> 
<p style="text-indent:50px;"><strong>（1）offset：目标位置</strong></p> 
<p style="text-indent:50px;"><strong>（2）whence：偏移的参照点，有效值是SEEK_SET、SEEK_CUR、SEEK_END，含义如下：</strong></p> 
<p style="text-indent:50px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<strong>SEEK_SET：从文件开头算起</strong></p> 
<p style="text-indent:50px;"><strong>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SEEK_CUR：从当前所在的位置算起，偏移offset字节，正值表示往文件尾部偏移，负值表示往文件头部偏移</strong></p> 
<p style="text-indent:50px;"><strong>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SEEK_END：从文件结尾算起，正值表示往文件尾部偏移，负值表示往文件头部偏移</strong></p> 
<h3 id="%E5%85%AB%E3%80%81ioctl%E5%87%BD%E6%95%B0"><a name="t7"></a><a name="t7"></a><strong>八、ioctl函数</strong></h3> 
<p style="text-indent:0;"><strong>1.文件I/O操作还有很多不好归到read()/write()的，只好放在这个函数中。很多设备文件用过ioctl()函数提供设备特有的操作，比如修改设备寄存器的值。ioctl()是文件i/o的杂项函数，其函数原型在&lt;sys/ioctl.h&gt;中定义：</strong></p> 
<pre class="has" name="code"><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">ioctl</span><span class="hljs-params">(<span class="hljs-keyword">int</span> fd, <span class="hljs-keyword">int</span> cmd, ...)</span></span>;</code><div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}" onclick="hljs.copyCode(event)"></div></pre> 
<p style="text-indent:50px;"><strong>操作成功返回0；失败返回-1</strong></p> 
<p style="text-indent:0;"><strong>2.参数</strong></p> 
<p style="text-indent:50px;"><strong>（1）cmd：文件的操作命令。该命令是文件专有的，不同的文件，cmd往往是不同的</strong></p> 
<p style="text-indent:50px;"><strong>（2）“...”：表示从参数是可选的、类型不确定的</strong></p> 
<hr>
<p><strong>示例代码：</strong></p> 
<pre class="has" name="code"><code class="hljs cpp"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;fcntl.h&gt;</span></span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/types.h&gt;</span></span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/ioctl.h&gt;</span></span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argvp[])</span></span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">{</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	<span class="hljs-keyword">char</span> buf[<span class="hljs-number">128</span>] = { <span class="hljs-number">0</span> };</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	<span class="hljs-keyword">char</span> w_str[] = <span class="hljs-string">"Hello,Linux file.\n"</span>;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	<span class="hljs-keyword">char</span> filename[] = <span class="hljs-string">"hello.txt"</span>;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	<span class="hljs-keyword">int</span> fd, rec;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	<span class="hljs-keyword">int</span> mode = <span class="hljs-number">0x664</span>;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	<span class="hljs-keyword">int</span> cur, newcur, offset = <span class="hljs-number">0</span>;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	fd = open(filename, O_RDWR|O_CREAT, mode);	<span class="hljs-comment">//以可读写、创建标志打开文件,mode=0x664</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	<span class="hljs-keyword">if</span> (fd &lt; <span class="hljs-number">0</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	{</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">		<span class="hljs-built_in">printf</span>(<span class="hljs-string">"open file error.\n"</span>);</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">		<span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	}</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	rec = read(fd, buf, <span class="hljs-keyword">sizeof</span>(buf));	<span class="hljs-comment">//读文件</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	<span class="hljs-keyword">if</span> (rec &lt; <span class="hljs-number">0</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">		<span class="hljs-built_in">printf</span>(<span class="hljs-string">"read file error.\n"</span>);</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="26"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="27"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	rec = write(fd, w_str, <span class="hljs-keyword">sizeof</span>(w_str));	<span class="hljs-comment">//写文件</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="28"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	<span class="hljs-keyword">if</span> (rec &lt; <span class="hljs-number">0</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="29"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">		<span class="hljs-built_in">printf</span>(<span class="hljs-string">"write file error.\n"</span>);</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="30"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="31"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	cur = lseek(fd, <span class="hljs-number">0</span>, SEEK_CUR);	<span class="hljs-comment">//获取当前读写位置</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="32"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	offset = <span class="hljs-number">18</span> - cur;	<span class="hljs-comment">//移动到偏移18个字节的位置读数据</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="33"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	newcur = lseek(fd, offset, SEEK_CUR);	<span class="hljs-comment">//从当前位置,移动到18</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="34"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	<span class="hljs-keyword">if</span> (newcur == <span class="hljs-number">-1</span>)</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="35"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">		<span class="hljs-built_in">printf</span>(<span class="hljs-string">"lseek error.\n"</span>);</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="36"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="37"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	fsync(fd);	<span class="hljs-comment">//同步文件</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="38"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	close(fd);	<span class="hljs-comment">//关闭文件</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="39"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="40"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="41"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}</div></div></li></ol></code><div class="hljs-button {2}" data-title="复制" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.4259&quot;}" onclick="hljs.copyCode(event)"></div></pre> 
<p>&nbsp;</p>
                </div><div data-report-view="{&quot;mod&quot;:&quot;1585297308_001&quot;,&quot;dest&quot;:&quot;https://blog.csdn.net/saymmp/article/details/90287125&quot;,&quot;extend1&quot;:&quot;pc&quot;,&quot;ab&quot;:&quot;new&quot;}"><div></div></div>
        </div>